<!DOCTYPE html>
<html>
<head>
  <title>YouTube Channel ID Finder</title>
  <style>
    body { font-family: Arial; max-width: 800px; margin: 50px auto; padding: 20px; }
    input { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
    button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
    pre { background: #f4f4f4; padding: 15px; overflow-x: auto; }
    .result { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>YouTube Channel ID Finder</h1>
  <p>Enter your YouTube channel handle (e.g., @mehrzad.samadi) or channel ID:</p>
  <p style="background: #e3f2fd; padding: 10px; border-left: 4px solid #2196f3;">
    <strong>Note:</strong> Using allOrigins CORS proxy to fetch YouTube RSS feeds (free service).
  </p>

  <input type="text" id="channelInput" value="@mehrzad.samadi" placeholder="@username or channel ID">
  <button onclick="testChannel()">Test Channel</button>

  <div class="result" id="result"></div>

  <script>
    async function testChannel() {
      const input = document.getElementById('channelInput').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<p>Testing...</p>';

      const tests = [];

      // Test 1: user handle without @
      const handle = input.replace('@', '');
      const rssUrl1 = `https://www.youtube.com/feeds/videos.xml?user=${handle}`;
      tests.push({ name: 'User handle', url: rssUrl1 });

      // Test 2: channel_id format
      if (input.startsWith('UC')) {
        const rssUrl2 = `https://www.youtube.com/feeds/videos.xml?channel_id=${input}`;
        tests.push({ name: 'Channel ID', url: rssUrl2 });
      } else if (!input.startsWith('@')) {
        // Try as channel ID anyway
        const rssUrl2 = `https://www.youtube.com/feeds/videos.xml?channel_id=${input}`;
        tests.push({ name: 'Channel ID (assumed)', url: rssUrl2 });
      }

      let results = '<h2>Results (via CORS Proxy - No API Key Needed):</h2>';

      for (const test of tests) {
        try {
          // Use CORS proxy to avoid CORS issues
          const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(test.url)}`;
          const response = await fetch(proxyUrl);

          results += `<h3>${test.name}</h3>`;
          results += `<p><strong>RSS URL:</strong> ${test.url}</p>`;
          results += `<p><strong>Proxy URL:</strong> ${proxyUrl}</p>`;
          results += `<p><strong>HTTP Status:</strong> ${response.status}</p>`;

          if (response.ok) {
            const xmlText = await response.text();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');

            const entries = xmlDoc.querySelectorAll('entry');
            const channelTitle = xmlDoc.querySelector('title')?.textContent;

            if (entries.length > 0) {
              results += `<p style="color: green;"><strong>✅ SUCCESS - Found ${entries.length} videos</strong></p>`;
              results += `<p><strong>Channel:</strong> ${channelTitle}</p>`;
              results += '<p><strong>Latest 5 videos:</strong></p><ul>';

              for (let i = 0; i < Math.min(entries.length, 5); i++) {
                const entry = entries[i];
                const videoId = entry.querySelector('videoId')?.textContent ||
                              entry.querySelector('yt\\:videoId')?.textContent;
                const title = entry.querySelector('title')?.textContent;
                const published = entry.querySelector('published')?.textContent;

                if (videoId && title) {
                  results += `<li><strong>${title}</strong><br>`;
                  results += `Video ID: ${videoId}<br>`;
                  results += `Published: ${published ? new Date(published).toLocaleDateString() : 'N/A'}</li>`;
                }
              }
              results += '</ul>';
            } else {
              results += `<p style="color: orange;"><strong>⚠️ No videos found</strong></p>`;
            }
          } else {
            results += `<p style="color: red;"><strong>❌ FAILED - HTTP ${response.status}</strong></p>`;
          }
        } catch (error) {
          results += `<h3>${test.name}</h3>`;
          results += `<p style="color: red;"><strong>Error:</strong> ${error.message}</p>`;
        }
      }

      resultDiv.innerHTML = results;
    }

    // Auto-run on load
    window.onload = () => testChannel();
  </script>
</body>
</html>
